# ê¸‰ì—¬ì²˜ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¡° ì •ë¦¬

## ğŸ“‹ ëª©ì°¨
1. [ì „ì²´ íë¦„ë„](#ì „ì²´-íë¦„ë„)
2. [Firestore ì»¬ë ‰ì…˜ êµ¬ì¡°](#firestore-ì»¬ë ‰ì…˜-êµ¬ì¡°)
3. [ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°](#ì»´í¬ë„ŒíŠ¸-êµ¬ì¡°)
4. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
5. [ì£¼ìš” ê³„ì‚° ë¡œì§](#ì£¼ìš”-ê³„ì‚°-ë¡œì§)
6. [ë¬¸ì œì  ë° ê°œì„ ë°©í–¥](#ë¬¸ì œì -ë°-ê°œì„ ë°©í–¥)

---

## ğŸ”„ ì „ì²´ íë¦„ë„

```
1. ìŠ¤ì¼€ì¤„ ì…ë ¥ (ScheduleInputNew.tsx)
   â””â”€> schedules ì»¬ë ‰ì…˜ì— ì €ì¥

2. ê·¼ë¬´ì‹œê°„ ë¹„êµ (WorkTimeComparison.tsx)
   â”œâ”€> schedulesì—ì„œ ì˜ˆì •ê·¼ë¬´ì‹œê°„ ì¡°íšŒ
   â”œâ”€> ì‹¤ì œ ê·¼ë¬´ì‹œê°„ ì…ë ¥
   â””â”€> workTimeComparisonResultsì— ì €ì¥
       (ìƒíƒœ: time_match, review_required, review_completed)

3. ì§€ì ë³„ ê²€í† ì™„ë£Œ (WorkTimeComparison.tsx)
   â””â”€> employeeReviewStatus ì—…ë°ì´íŠ¸ (ê²€í† ì™„ë£Œ)

4. ì§ì›ë³„ ê¸‰ì—¬ì²˜ë¦¬ (EmployeePayrollProcessing.tsx)
   â”œâ”€> ê·¼ë¬´ì‹œê°„ë¹„êµ í™”ë©´ (WorkTimeComparison)
   â””â”€> ê¸‰ì—¬ê³„ì‚° í™”ë©´ (PayrollCalculation)
       â”œâ”€> workTimeComparisonResultsì—ì„œ ì‹¤ê·¼ë¬´ì‹œê°„ ì¡°íšŒ
       â”œâ”€> employmentContractsì—ì„œ ê³„ì•½ì •ë³´ ì¡°íšŒ
       â”œâ”€> employeesì—ì„œ ì§ì›ì •ë³´ ì¡°íšŒ
       â”œâ”€> ê¸‰ì—¬ ê³„ì‚° (ìˆ˜ìŠµ, ì£¼íœ´ìˆ˜ë‹¹, 4ëŒ€ë³´í—˜, ì„¸ê¸ˆ)
       â””â”€> ê¸‰ì—¬í™•ì • ì‹œ confirmedPayrollsì— ì €ì¥

5. ì„¸ë¬´ì‚¬ ì „ì†¡íŒŒì¼ ìƒì„± (TaxFileGeneration.tsx)
   â””â”€> confirmedPayrollsì—ì„œ í™•ì •ëœ ê¸‰ì—¬ ì¡°íšŒ
```

---

## ğŸ—„ï¸ Firestore ì»¬ë ‰ì…˜ êµ¬ì¡°

### 1. `employees` - ì§ì› ê¸°ë³¸ì •ë³´
**ìš©ë„**: ì§ì›ì˜ ê¸°ë³¸ ì •ë³´ ì €ì¥ (ì´ë¦„, ì—°ë½ì²˜, ì€í–‰ì •ë³´, ìˆ˜ìŠµì •ë³´ ë“±)

```typescript
{
  id: string;                    // ë¬¸ì„œ ID (ìë™ìƒì„±)
  name: string;                  // ì§ì›ëª…
  phone?: string;                // ì „í™”ë²ˆí˜¸
  email?: string;                // ì´ë©”ì¼
  residentNumber?: string;       // ì£¼ë¯¼ë²ˆí˜¸ (ë’·ìë¦¬ ì•”í˜¸í™” ê¶Œì¥)
  hireDate?: Date;               // ì…ì‚¬ì¼
  resignationDate?: Date;        // í‡´ì‚¬ì¼ (nullì´ë©´ ì¬ì§ì¤‘)
  
  // ì€í–‰ì •ë³´
  bankName?: string;             // ì€í–‰ëª…
  bankCode?: string;             // ì€í–‰ì½”ë“œ
  accountNumber?: string;        // ê³„ì¢Œë²ˆí˜¸
  accountHolder?: string;        // ì˜ˆê¸ˆì£¼ëª…
  
  // ìˆ˜ìŠµê¸°ê°„ ê´€ë¦¬
  probationStartDate?: Date;     // ìˆ˜ìŠµ ì‹œì‘ì¼
  probationEndDate?: Date;       // ìˆ˜ìŠµ ì¢…ë£Œì¼
  probationPeriod?: number;      // ìˆ˜ìŠµê¸°ê°„ (ê°œì›”, ê¸°ë³¸ê°’ 3)
  isOnProbation?: boolean;       // í˜„ì¬ ìˆ˜ìŠµ ì¤‘ ì—¬ë¶€
  
  // ë©”ëª¨
  memo?: string;                 // ì§ì› ë©”ëª¨
  
  // ìŠ¤ì¼€ì¤„ ë…¸ì¶œ ì—¬ë¶€
  hideFromSchedule?: boolean;    // trueë©´ ìŠ¤ì¼€ì¤„ ê´€ë¦¬ í™”ë©´ì—ì„œ ìˆ¨ê¹€
  
  createdAt: Date;
  updatedAt: Date;
}
```

**ì£¼ì˜ì‚¬í•­**:
- `resignationDate`ê°€ ìˆìœ¼ë©´ í‡´ì‚¬ìë¡œ ê°„ì£¼
- `hideFromSchedule`ê°€ trueì¸ ì›”ê¸‰ ì§ì›ì€ ê·¼ë¬´ì‹œê°„ë¹„êµ ì—†ì´ ê¸‰ì—¬ê³„ì‚° ê°€ëŠ¥
- ìˆ˜ìŠµê¸°ê°„ ì •ë³´ëŠ” ì—¬ê¸° ì €ì¥ë˜ì§€ë§Œ, ì‹¤ì œ ê¸‰ì—¬ê³„ì‚° ì‹œ employmentContractsì˜ ì •ë³´ê°€ ìš°ì„ 

---

### 2. `employeeBranches` - ì§ì›-ì§€ì  ê´€ê³„
**ìš©ë„**: í•œ ì§ì›ì´ ì—¬ëŸ¬ ì§€ì ì—ì„œ ê·¼ë¬´ ê°€ëŠ¥í•˜ë„ë¡ N:N ê´€ê³„ ê´€ë¦¬

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  employeeId: string;            // ì§ì› ID
  branchId: string;              // ì§€ì  ID
  createdAt: Date;
}
```

**ì£¼ì˜ì‚¬í•­**:
- ì§ì› ì¶”ê°€ ì‹œ ë°˜ë“œì‹œ ìµœì†Œ 1ê°œ ì´ìƒì˜ ì§€ì  ê´€ê³„ ìƒì„± í•„ìš”
- ì§ì› ì‚­ì œ ì‹œ ê´€ë ¨ employeeBranchesë„ í•¨ê»˜ ì‚­ì œ í•„ìš”

---

### 3. `branches` - ì§€ì ì •ë³´
**ìš©ë„**: ì§€ì  ê¸°ë³¸ ì •ë³´

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  name: string;                  // ì§€ì ëª… (ì˜ˆ: "ì²­ë‹´ì¥ì–´ë§ˆì¼“ ë™íƒ„ì ")
  companyName?: string;          // íšŒì‚¬ëª…
  ceoName?: string;              // ëŒ€í‘œìëª…
  businessNumber?: string;       // ì‚¬ì—…ìë²ˆí˜¸
  address?: string;              // ì£¼ì†Œ
  phone?: string;                // ì „í™”ë²ˆí˜¸
  managerEmails?: string[];      // ë§¤ë‹ˆì € ì´ë©”ì¼ ëª©ë¡
  createdAt: Date;
  updatedAt: Date;
}
```

---

### 4. `employmentContracts` - ê·¼ë¡œê³„ì•½ì„œ (íˆìŠ¤í† ë¦¬)
**ìš©ë„**: ì§ì›ì˜ ê·¼ë¡œê³„ì•½ ì •ë³´ íˆìŠ¤í† ë¦¬ ê´€ë¦¬ (ê³ ìš©í˜•íƒœ, ê¸‰ì—¬í˜•íƒœ, ê¸‰ì—¬ì•¡ ë“±)

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  employeeId: string;            // ì§ì› ID
  employeeName: string;          // ì§ì›ëª… (denormalized)
  
  // ê³ ìš©ì •ë³´
  employmentType: string;        // 'ê·¼ë¡œì†Œë“' | 'ì‚¬ì—…ì†Œë“' | 'ì¼ìš©ì§' | 'ì™¸êµ­ì¸'
  salaryType: string;            // 'hourly' | 'monthly' (ì‹œê¸‰/ì›”ê¸‰)
  salaryAmount: number;          // ì‹œê¸‰ ë˜ëŠ” ì›”ê¸‰ì•¡
  
  // ê·¼ë¬´ì¡°ê±´
  weeklyWorkHours?: number;      // ì£¼ê°„ ê·¼ë¬´ì‹œê°„ (ê¸°ë³¸ 40ì‹œê°„)
  includeHolidayAllowance?: boolean; // ì£¼íœ´ìˆ˜ë‹¹ í¬í•¨ ì—¬ë¶€ (ì‹œê¸‰ì— ì£¼íœ´ìˆ˜ë‹¹ì´ ì´ë¯¸ í¬í•¨ë˜ì–´ìˆëŠ”ì§€)
  
  // ê³„ì•½ê¸°ê°„
  startDate: Date;               // ê³„ì•½ ì‹œì‘ì¼
  endDate?: Date;                // ê³„ì•½ ì¢…ë£Œì¼ (ì—†ìœ¼ë©´ í˜„ì¬ ìœ íš¨)
  
  // ê³„ì•½ì„œ íŒŒì¼
  contractFile?: string;         // Base64 ë˜ëŠ” Firebase Storage URL
  contractFileName?: string;     // íŒŒì¼ëª…
  fileType?: string;             // íŒŒì¼ íƒ€ì…
  fileSize?: number;             // íŒŒì¼ í¬ê¸°
  isBase64?: boolean;            // Base64 ì €ì¥ ì—¬ë¶€
  
  createdAt: Date;
  updatedAt: Date;
}
```

**âš ï¸ ì¤‘ìš” ì„¤ê³„ - ìˆ˜ìŠµê¸°ê°„ ì •ë³´ ìœ„ì¹˜**:
- **ìˆ˜ìŠµê¸°ê°„ ì •ë³´ëŠ” `employees` ì»¬ë ‰ì…˜ì— ì €ì¥ë¨** (probationStartDate, probationEndDate, probationPeriod)
- **ì´ìœ **: 
  - ì¬ì…ì‚¬ ì¼€ì´ìŠ¤ê°€ ì—†ìœ¼ë¯€ë¡œ ì§ì›ë‹¹ ìˆ˜ìŠµê¸°ê°„ì€ 1íšŒë¿
  - `employmentContracts`ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒë³´ë‹¤ ë‹¨ìˆœí•˜ê³  ì§ê´€ì 
  - ê¸‰ì—¬ê³„ì‚° ì‹œ ì§ì› ì •ë³´ì—ì„œ ì§ì ‘ ì¡°íšŒ ê°€ëŠ¥

**ì¤‘ìš” ë¡œì§**:
- ê¸‰ì—¬ê³„ì‚° ì‹œ `selectedMonth`ì— ìœ íš¨í•œ ê³„ì•½ì„œë¥¼ ì°¾ì•„ì•¼ í•¨
  - `startDate <= monthEnd && (endDate == null || endDate >= monthStart)`
- í•œ ì§ì›ì´ ì—¬ëŸ¬ ê°œì˜ ê³„ì•½ì„œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ (ê¸°ê°„ë³„ë¡œ)
- **ìˆ˜ìŠµê¸°ê°„ ê³„ì‚°**: í˜„ì¬ëŠ” `employees` ì»¬ë ‰ì…˜ì˜ probationStartDate ~ probationEndDateë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ê¸°ê°„ì˜ ê·¼ë¬´ì‹œê°„ì— ê¸‰ì—¬ì˜ 90% ì ìš©

**employmentTypeë³„ ê¸‰ì—¬ ê³„ì‚° ë°©ì‹**:
1. **ê·¼ë¡œì†Œë“** (ì‹œê¸‰): ê¸°ë³¸ê¸‰ + ì£¼íœ´ìˆ˜ë‹¹ - 4ëŒ€ë³´í—˜ - ì†Œë“ì„¸
2. **ê·¼ë¡œì†Œë“** (ì›”ê¸‰): ì›”ê¸‰ - ë¬´ê¸‰íœ´ê°€ì°¨ê° - 4ëŒ€ë³´í—˜ - ì†Œë“ì„¸
3. **ì‚¬ì—…ì†Œë“** (ì‹œê¸‰): ê¸°ë³¸ê¸‰ + ì£¼íœ´ìˆ˜ë‹¹ - 3.3% ì„¸ê¸ˆ
4. **ì‚¬ì—…ì†Œë“** (ì›”ê¸‰): ì›”ê¸‰ - 3.3% ì„¸ê¸ˆ
5. **ì¼ìš©ì§**: ì‹œê¸‰ë§Œ, ì„¸ê¸ˆ ì—†ìŒ, ì£¼íœ´ìˆ˜ë‹¹ ì—†ìŒ
6. **ì™¸êµ­ì¸**: ì‹œê¸‰ë§Œ, 3.3% ì„¸ê¸ˆ, ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚° (ì‚¬ì—…ì†Œë“ê³¼ ë™ì¼)

---

### 5. `schedules` - ìŠ¤ì¼€ì¤„
**ìš©ë„**: ì§ì›ë³„ ì¼ë³„ ì˜ˆì • ê·¼ë¬´ ìŠ¤ì¼€ì¤„

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  employeeId: string;            // ì§ì› ID
  employeeName: string;          // ì§ì›ëª… (denormalized)
  branchId: string;              // ì§€ì  ID
  branchName: string;            // ì§€ì ëª… (denormalized)
  date: Date;                    // ê·¼ë¬´ì¼ (ì˜ˆ: 2025-09-15)
  
  // ê·¼ë¬´ì‹œê°„
  startTime: string;             // ì‹œì‘ì‹œê°„ (ì˜ˆ: "09:00")
  endTime: string;               // ì¢…ë£Œì‹œê°„ (ì˜ˆ: "18:00")
  breakTime: number;             // íœ´ê²Œì‹œê°„ (ì‹œê°„ ë‹¨ìœ„, ì˜ˆ: 1)
  
  // ê³„ì‚°ëœ ê°’
  scheduledHours?: number;       // ì˜ˆì •ê·¼ë¬´ì‹œê°„ (endTime - startTime)
  actualWorkHours?: number;      // ì‹¤ê·¼ë¬´ì‹œê°„ (scheduledHours - breakTime)
  
  weekStart?: Date;              // í•´ë‹¹ ì£¼ì˜ ì‹œì‘ì¼ (ì›”ìš”ì¼)
  weekEnd?: Date;                // í•´ë‹¹ ì£¼ì˜ ì¢…ë£Œì¼ (ì¼ìš”ì¼)
  
  createdAt: Date;
  updatedAt?: Date;
}
```

**ì£¼ì˜ì‚¬í•­**:
- `date`ëŠ” Date íƒ€ì…ìœ¼ë¡œ ì €ì¥ (Firestore Timestamp)
- ê°™ì€ ì§ì›, ê°™ì€ ë‚ ì§œ, ê°™ì€ ì§€ì ì— ì¤‘ë³µ ìŠ¤ì¼€ì¤„ì´ ì—†ì–´ì•¼ í•¨
- ìŠ¤ì¼€ì¤„ ì…ë ¥ ì‹œ ë‹¤ë¥¸ ì§€ì  ìŠ¤ì¼€ì¤„ ê°€ì ¸ì˜¤ê¸° ê¸°ëŠ¥ ìˆìŒ (ì¼ìš”ì¼ í¬í•¨ ì£¼ì˜)

---

### 6. `workTimeComparisonResults` - ê·¼ë¬´ì‹œê°„ ë¹„êµ ê²°ê³¼
**ìš©ë„**: ì˜ˆì •ê·¼ë¬´ì‹œê°„ vs ì‹¤ì œê·¼ë¬´ì‹œê°„ ë¹„êµ ë° í™•ì • ë°ì´í„°

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  employeeId: string;            // ì§ì› ID
  employeeName: string;          // ì§ì›ëª…
  branchId: string;              // ì§€ì  ID
  branchName: string;            // ì§€ì ëª…
  month: string;                 // "2025-09" í˜•ì‹
  date: string;                  // "2025-09-15" í˜•ì‹ ë˜ëŠ” Date
  
  // ì˜ˆì • ê·¼ë¬´ì‹œê°„ (schedulesì—ì„œ ê°€ì ¸ì˜´)
  scheduledHours: number;        // ì˜ˆì •ê·¼ë¬´ì‹œê°„ (ì‹œê°„ ë‹¨ìœ„)
  scheduledTimeRange: string;    // ì˜ˆ: "09:00-18:00"
  
  // ì‹¤ì œ ê·¼ë¬´ì‹œê°„ (ì‚¬ìš©ìê°€ ì…ë ¥)
  actualHours: number;           // ì‹¤ì œê·¼ë¬´ì‹œê°„ (ì‹œê°„ ë‹¨ìœ„)
  actualTimeRange: string;       // ì˜ˆ: "09:05-18:10"
  breakTime: number;             // íœ´ê²Œì‹œê°„ (ì‹œê°„ ë‹¨ìœ„)
  actualWorkHours: number;       // ì‹¤ê·¼ë¬´ì‹œê°„ = actualHours - breakTime
  
  // ì°¨ì´
  difference: number;            // actualHours - scheduledHours
  
  // ìƒíƒœ
  status: string;                // 'time_match' | 'review_required' | 'review_completed'
  
  // ë©”íƒ€ë°ì´í„°
  isModified: boolean;           // ìˆ˜ì • ì—¬ë¶€
  modifiedAt?: Date;             // ìˆ˜ì • ì‹œê°
  createdAt: Date;
  updatedAt: Date;
}
```

**ì¤‘ìš” ë¡œì§**:
- **ê¸‰ì—¬ê³„ì‚°ì˜ í•µì‹¬ ë°ì´í„°**: PayrollCalculationì€ ì´ ì»¬ë ‰ì…˜ì—ì„œ `actualWorkHours`ë¥¼ í•©ì‚°í•˜ì—¬ ì´ ê·¼ë¬´ì‹œê°„ ê³„ì‚°
- `status`:
  - `time_match`: ì˜ˆì •ì‹œê°„ê³¼ ì‹¤ì œì‹œê°„ì´ ì¼ì¹˜ (ìë™)
  - `review_required`: ì°¨ì´ê°€ ìˆì–´ì„œ ê²€í†  í•„ìš”
  - `review_completed`: ì‚¬ìš©ìê°€ "í™•ì¸ì™„ë£Œ" ë²„íŠ¼ í´ë¦­

**ì¿¼ë¦¬ ì˜ˆì‹œ**:
```typescript
// íŠ¹ì • ì§ì›ì˜ íŠ¹ì • ì›” ë°ì´í„° ì¡°íšŒ
query(
  collection(db, 'workTimeComparisonResults'),
  where('employeeId', '==', employeeId),
  where('month', '==', '2025-09')
)
```

---

### 7. `employeeReviewStatus` - ì§ì›ë³„ ê²€í†  ìƒíƒœ
**ìš©ë„**: ì§ì›ë³„ + ì§€ì ë³„ + ì›”ë³„ ê·¼ë¬´ì‹œê°„ ê²€í†  ì™„ë£Œ ì—¬ë¶€

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  employeeId: string;            // ì§ì› ID
  branchId: string;              // ì§€ì  ID
  month: string;                 // "2025-09" í˜•ì‹
  status: string;                // 'ê²€í† ì „' | 'ê²€í† ì¤‘' | 'ê²€í† ì™„ë£Œ'
  updatedAt: Date;
}
```

**ì¤‘ìš” ë¡œì§**:
- í•œ ì§ì›ì´ ì—¬ëŸ¬ ì§€ì ì—ì„œ ê·¼ë¬´í•˜ë©´ ì§€ì ë³„ë¡œ ê°ê° ê²€í†  ìƒíƒœ ê´€ë¦¬
- `ê²€í† ì™„ë£Œ` ìƒíƒœê°€ ë˜ë©´ í•´ë‹¹ ì§€ì ì˜ ê·¼ë¬´ì‹œê°„ ìˆ˜ì • ë¶ˆê°€
- ê¸‰ì—¬í™•ì • í›„ì—ëŠ” ìˆ˜ì • ì™„ì „ ë¶ˆê°€

**ìƒíƒœ ì „í™˜**:
```
ê²€í† ì „ â†’ ê²€í† ì¤‘ (ì²« í™•ì¸ì™„ë£Œ ì‹œ) â†’ ê²€í† ì™„ë£Œ (ëª¨ë“  í•­ëª© í™•ì¸ì™„ë£Œ ì‹œ)
```

---

### 8. `employeeMemos` - ì§ì›ë³„ ê¸‰ì—¬ë©”ëª¨
**ìš©ë„**: ì§ì›ë³„ + ì›”ë³„ ê¸‰ì—¬ ê´€ë ¨ ë©”ëª¨

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  employeeId: string;            // ì§ì› ID
  month: string;                 // "2025-09" í˜•ì‹
  memo: string;                  // ë©”ëª¨ ë‚´ìš©
  createdAt: Date;
  updatedAt: Date;
}
```

**ì£¼ì˜ì‚¬í•­**:
- í•œ ì§ì›ì˜ í•œ ë‹¬ì— í•˜ë‚˜ì˜ ë©”ëª¨ë§Œ ì¡´ì¬
- ê¸‰ì—¬ ê³„ì‚° í™”ë©´ì—ì„œ ì…ë ¥ ê°€ëŠ¥

---

### 9. `confirmedPayrolls` - ê¸‰ì—¬í™•ì • ê¸°ë¡
**ìš©ë„**: ê¸‰ì—¬í™•ì • ì™„ë£Œëœ ì§ì›ì˜ ìµœì¢… ê¸‰ì—¬ ë°ì´í„°

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  employeeId: string;            // ì§ì› ID
  employeeName: string;          // ì§ì›ëª…
  month: string;                 // "2025-09" í˜•ì‹
  
  // ì§ì›ì •ë³´
  residentNumber?: string;       // ì£¼ë¯¼ë²ˆí˜¸
  bankName?: string;             // ì€í–‰ëª…
  bankCode?: string;             // ì€í–‰ì½”ë“œ
  accountNumber?: string;        // ê³„ì¢Œë²ˆí˜¸
  accountHolder?: string;        // ì˜ˆê¸ˆì£¼ëª…
  
  // ê¸‰ì—¬ì •ë³´
  employmentType: string;        // ê³ ìš©í˜•íƒœ
  salaryType: string;            // ê¸‰ì—¬í˜•íƒœ (ì‹œê¸‰/ì›”ê¸‰)
  hourlyWage?: number;           // ì‹œê¸‰
  monthlySalary?: number;        // ì›”ê¸‰
  totalWorkHours: number;        // ì´ ê·¼ë¬´ì‹œê°„
  actualWorkHours: number;       // ì‹¤ê·¼ë¬´ì‹œê°„
  grossPay: number;              // ì§€ê¸‰ì´ì•¡ (ê¸°ë³¸ê¸‰ + ì£¼íœ´ìˆ˜ë‹¹)
  
  // ê³µì œ
  deductions: {
    insurance: number;           // 4ëŒ€ë³´í—˜ (ê·¼ë¡œì†Œë“ë§Œ)
    tax: number;                 // ì„¸ê¸ˆ
    total: number;               // ì´ ê³µì œì•¡
    insuranceDetails?: {         // 4ëŒ€ë³´í—˜ ìƒì„¸
      nationalPension: number;   // êµ­ë¯¼ì—°ê¸ˆ
      healthInsurance: number;   // ê±´ê°•ë³´í—˜
      longTermCare: number;      // ì¥ê¸°ìš”ì–‘ë³´í—˜
      employmentInsurance: number; // ê³ ìš©ë³´í—˜
    };
    taxDetails?: {               // ì„¸ê¸ˆ ìƒì„¸
      incomeTax: number;         // ì†Œë“ì„¸
      localIncomeTax: number;    // ì§€ë°©ì†Œë“ì„¸
    };
  };
  netPay: number;                // ì‹¤ìˆ˜ë ¹ì•¡
  
  // ì§€ì ë³„ ê·¼ë¬´ì‹œê°„
  branches: Array<{
    branchId: string;
    branchName: string;
    workHours: number;
  }>;
  
  // ìˆ˜ìŠµê¸°ê°„ ì •ë³´
  probationHours?: number;       // ìˆ˜ìŠµê¸°ê°„ ê·¼ë¬´ì‹œê°„
  regularHours?: number;         // ì •ê·œ ê·¼ë¬´ì‹œê°„
  probationPay?: number;         // ìˆ˜ìŠµê¸°ê°„ ê¸‰ì—¬
  regularPay?: number;           // ì •ê·œ ê¸‰ì—¬
  
  // ì£¼íœ´ìˆ˜ë‹¹
  weeklyHolidayPay?: number;     // ì£¼íœ´ìˆ˜ë‹¹ ì´ì•¡
  weeklyHolidayHours?: number;   // ì£¼íœ´ìˆ˜ë‹¹ ì‹œê°„
  weeklyHolidayDetails?: Array<{
    weekStart: string;
    weekEnd: string;
    hours: number;
    pay: number;
    eligible: boolean;
  }>;
  
  // ë¬´ê¸‰íœ´ê°€ (ê·¼ë¡œì†Œë“+ì›”ê¸‰ë§Œ)
  unpaidLeaveDays?: number;      // ë¬´ê¸‰íœ´ê°€ ì¼ìˆ˜
  unpaidLeaveDeduction?: number; // ë¬´ê¸‰íœ´ê°€ ì°¨ê°ì•¡
  
  // ë©”ëª¨
  memo?: string;                 // ë¹„ê³  (ì„¸ë¬´ì‚¬ ì „ì†¡ìš©)
  
  createdAt: Date;
  updatedAt: Date;
}
```

**ì¤‘ìš” ë¡œì§**:
- ê¸‰ì—¬í™•ì • ì‹œ PayrollCalculationì—ì„œ ê³„ì‚°ëœ ëª¨ë“  ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ì €ì¥
- **ê¸‰ì—¬í™•ì • ì—¬ë¶€ í™•ì¸**: ì´ ì»¬ë ‰ì…˜ì— ë¬¸ì„œê°€ ì¡´ì¬í•˜ë©´ í™•ì •ë¨, ì—†ìœ¼ë©´ ë¯¸í™•ì •
- **ê¸‰ì—¬í™•ì • ì·¨ì†Œ**: í•´ë‹¹ ë¬¸ì„œë¥¼ ì‚­ì œ
- í™•ì • í›„ì—ëŠ” ê·¼ë¬´ì‹œê°„ë¹„êµ, ê¸‰ì—¬ê³„ì‚° ëª¨ë‘ ìˆ˜ì • ë¶ˆê°€
- ì„¸ë¬´ì‚¬ ì „ì†¡íŒŒì¼ ìƒì„± ì‹œ ì´ ì»¬ë ‰ì…˜ì—ì„œ ë°ì´í„° ì¡°íšŒ

**ì°¸ê³ **:
- ë³„ë„ì˜ `payrollLocks` ì»¬ë ‰ì…˜ì´ë‚˜ `status` í•„ë“œ ì—†ì´ ë¬¸ì„œì˜ ì¡´ì¬ ì—¬ë¶€ë§Œìœ¼ë¡œ í™•ì • ìƒíƒœ ê´€ë¦¬
- ì´ëŠ” ê°€ì¥ ì‹¬í”Œí•˜ê³  ëª…í™•í•œ ë°©ì‹

---

### 10. `weeklyNotes` - ì£¼ê°„ ë¹„ê³ 
**ìš©ë„**: ì§€ì ë³„ + ì£¼ê°„ë³„ ë¹„ê³ /ë©”ëª¨

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  branchId: string;              // ì§€ì  ID
  branchName: string;            // ì§€ì ëª…
  weekStart: Date;               // ì£¼ ì‹œì‘ì¼ (ì›”ìš”ì¼)
  weekEnd: Date;                 // ì£¼ ì¢…ë£Œì¼ (ì¼ìš”ì¼)
  note: string;                  // ë¹„ê³  ë‚´ìš©
  createdAt: Date;
  updatedAt: Date;
}
```

**ì£¼ì˜ì‚¬í•­**:
- ê°™ì€ ì§€ì ì˜ ê°™ì€ ì£¼ê°„ì— í•˜ë‚˜ì˜ ë¹„ê³ ë§Œ ì¡´ì¬í•´ì•¼ í•¨
- ì €ì¥ ì‹œ ê¸°ì¡´ ë¬¸ì„œ ì¡´ì¬ ì—¬ë¶€ ì²´í¬ í›„ update/add ë¶„ê¸°

---

### 11. `bankCodes` - ì€í–‰ì½”ë“œ
**ìš©ë„**: ì€í–‰ëª…-ì€í–‰ì½”ë“œ ë§¤í•‘

```typescript
{
  id: string;                    // ë¬¸ì„œ ID
  code: string;                  // ì€í–‰ì½”ë“œ (ì˜ˆ: "004")
  name: string;                  // ì€í–‰ëª… (ì˜ˆ: "KBêµ­ë¯¼ì€í–‰")
}
```

---

## ğŸ—ï¸ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

### 1. `EmployeePayrollProcessing.tsx` (ìµœìƒìœ„)
**ì—­í• **: ì§ì›ë³„ ê¸‰ì—¬ì²˜ë¦¬ ì§„ì…ì , ì§ì› ëª©ë¡ + íƒ­ ê´€ë¦¬

**ì£¼ìš” ìƒíƒœ**:
```typescript
- employees: Employee[]           // ì§ì› ëª©ë¡
- contracts: Contract[]           // ê·¼ë¡œê³„ì•½ ëª©ë¡
- selectedEmployeeId: string      // ì„ íƒëœ ì§ì› ID
- selectedMonth: string           // ì„ íƒëœ ì›” (YYYY-MM)
- activeTab: 'work-comparison' | 'payroll-calculation'
```

**ì£¼ìš” ë¡œì§**:
1. `loadContracts()`: ì„ íƒëœ ì›”ì— ìœ íš¨í•œ ê·¼ë¡œê³„ì•½ë§Œ ë¡œë“œ
2. `loadEmployees()`: ìœ íš¨í•œ ê³„ì•½ì´ ìˆëŠ” ì§ì›ë§Œ í•„í„°ë§
3. ì§ì› ì„ íƒ ì‹œ `selectedEmployeeId` ì—…ë°ì´íŠ¸ â†’ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬

**ë¬¸ì œì **:
- `useEffect` ì˜ì¡´ì„± ë°°ì—´ì´ ë³µì¡í•˜ì—¬ ë¬´í•œë£¨í”„ ë°œìƒ ê°€ëŠ¥
- `loadEmployees`ì™€ `loadContracts` í˜¸ì¶œ ìˆœì„œì— ì˜ì¡´

**ê°œì„ ë°©í–¥**:
```typescript
// ëª…í™•í•œ ë°ì´í„° ë¡œë”© ìˆœì„œ
useEffect(() => {
  if (selectedMonth) {
    loadContracts();  // 1. ê³„ì•½ ë¡œë“œ
  }
}, [selectedMonth]);

useEffect(() => {
  if (contracts.length > 0) {
    loadEmployees();  // 2. ê³„ì•½ ë¡œë“œ ì™„ë£Œ í›„ ì§ì› ë¡œë“œ
  }
}, [contracts]);
```

---

### 2. `WorkTimeComparison.tsx`
**ì—­í• **: ê·¼ë¬´ì‹œê°„ ë¹„êµ ë° í™•ì •

**ì£¼ìš” ìƒíƒœ**:
```typescript
- comparisonResults: ComparisonResult[]  // ë¹„êµ ê²°ê³¼ ëª©ë¡
- employeeReviewStatus: ReviewStatus[]   // ê²€í†  ìƒíƒœ
- selectedBranchId: string               // ì„ íƒëœ ì§€ì 
```

**ì£¼ìš” ë¡œì§**:
1. `loadComparisonData()`: schedules + workTimeComparisonResults ì¡°íšŒ
   - schedulesì—ì„œ ì˜ˆì •ê·¼ë¬´ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
   - workTimeComparisonResultsì— ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ schedulesë¡œ ì´ˆê¸°í™”
2. `handleConfirm()`: ê°œë³„ í•­ëª© í™•ì¸ì™„ë£Œ
   - workTimeComparisonResultsì˜ statusë¥¼ 'review_completed'ë¡œ ì—…ë°ì´íŠ¸
3. `handleCompleteReview()`: ì§€ì ë³„ ì „ì²´ ê²€í† ì™„ë£Œ
   - employeeReviewStatusë¥¼ 'ê²€í† ì™„ë£Œ'ë¡œ ì—…ë°ì´íŠ¸

**ì¤‘ìš”í•œ ì¡°ê±´**:
- ê²€í† ì™„ë£Œ ìƒíƒœì—ì„œëŠ” ìˆ˜ì • ë¶ˆê°€
- ê¸‰ì—¬í™•ì • í›„ì—ëŠ” ì™„ì „íˆ ìˆ˜ì • ë¶ˆê°€

---

### 3. `PayrollCalculation.tsx`
**ì—­í• **: ê¸‰ì—¬ ê³„ì‚° ë° í™•ì •

**ì£¼ìš” ìƒíƒœ**:
```typescript
- employees: Employee[]                 // ì§ì› ëª©ë¡
- weeklySchedules: WeeklySchedule[]     // ì£¼ê°„ ìŠ¤ì¼€ì¤„ (workTimeComparisonResults)
- payrollCalculations: PayrollCalculation[]  // ê³„ì‚° ê²°ê³¼
```

**ì£¼ìš” ë¡œì§**:
1. `loadSchedules()`: workTimeComparisonResultsì—ì„œ ì‹¤ê·¼ë¬´ì‹œê°„ ì¡°íšŒ
   ```typescript
   query(
     collection(db, 'workTimeComparisonResults'),
     where('month', '==', selectedMonth),
     where('employeeId', '==', selectedEmployeeId)
   )
   ```

2. `calculatePayroll()`: ê¸‰ì—¬ ê³„ì‚° í•µì‹¬ ë¡œì§
   ```typescript
   // ì˜ì‚¬ì½”ë“œ
   for (ì§ì›ë³„) {
     // 1. ê³„ì•½ì •ë³´ ê°€ì ¸ì˜¤ê¸°
     contract = employmentContractsì—ì„œ ìœ íš¨í•œ ê³„ì•½ ì°¾ê¸°
     
     // 2. ì‹¤ê·¼ë¬´ì‹œê°„ í•©ì‚°
     totalWorkHours = workTimeComparisonResultsì˜ actualWorkHours í•©ì‚°
     
     // 3. ìˆ˜ìŠµê¸°ê°„ êµ¬ë¶„
     if (ìˆ˜ìŠµê¸°ê°„ ì •ë³´ ìˆìŒ) {
       schedulesë¥¼ ìˆœíšŒí•˜ë©°:
         if (schedule.dateê°€ ìˆ˜ìŠµê¸°ê°„ ë‚´) {
           probationHours += actualWorkHours
         } else {
           regularHours += actualWorkHours
         }
     }
     
     // 4. ê¸°ë³¸ê¸‰ ê³„ì‚°
     if (ì‹œê¸‰ì œ) {
       ê¸°ë³¸ê¸‰ = (probationHours * ì‹œê¸‰ * 0.9) + (regularHours * ì‹œê¸‰)
     } else if (ì›”ê¸‰ì œ) {
       ê¸°ë³¸ê¸‰ = ì›”ê¸‰ (ë˜ëŠ” ì›”ê¸‰ * 0.9)
       ë¬´ê¸‰íœ´ê°€ ì°¨ê° ë¡œì§
     }
     
     // 5. ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚° (ì‹œê¸‰ì œë§Œ, ì£¼íœ´ìˆ˜ë‹¹ í¬í•¨ ì•ˆëœ ê²½ìš°ë§Œ)
     if (ì‹œê¸‰ì œ && !includesWeeklyHolidayInWage) {
       ì£¼íœ´ìˆ˜ë‹¹ = calcWeeklyHolidayPay(...)
     }
     
     // 6. ê³µì œ ê³„ì‚°
     if (ê·¼ë¡œì†Œë“) {
       4ëŒ€ë³´í—˜ = êµ­ë¯¼ì—°ê¸ˆ + ê±´ê°•ë³´í—˜ + ì¥ê¸°ìš”ì–‘ + ê³ ìš©ë³´í—˜
       ì†Œë“ì„¸ = ê°„ì´ì„¸ì•¡í‘œ
       ì§€ë°©ì†Œë“ì„¸ = ì†Œë“ì„¸ * 0.1
     } else if (ì‚¬ì—…ì†Œë“ || ì™¸êµ­ì¸) {
       ì„¸ê¸ˆ = ê¸°ë³¸ê¸‰ * 0.033
     }
     
     // 7. ì‹¤ìˆ˜ë ¹ì•¡
     ì‹¤ìˆ˜ë ¹ì•¡ = ê¸°ë³¸ê¸‰ + ì£¼íœ´ìˆ˜ë‹¹ - 4ëŒ€ë³´í—˜ - ì„¸ê¸ˆ
   }
   ```

3. `handleConfirmPayroll()`: ê¸‰ì—¬í™•ì •
   - confirmedPayrollsì— ì €ì¥
   - payrollLocksì— ì ê¸ˆ ì„¤ì •

**ë¬¸ì œì **:
1. `useEffect`ì™€ `useCallback` ì˜ì¡´ì„± ë°°ì—´ ë¬¸ì œë¡œ ë¬´í•œë£¨í”„
2. ë°ì´í„° ë¡œë”© ìˆœì„œ ë¶ˆëª…í™• (employees, schedules, contracts ëˆ„ê°€ ë¨¼ì €?)
3. ê³„ì‚° ë¡œì§ì´ ë„ˆë¬´ ê¸¸ê³  ë³µì¡ (500ì¤„ ì´ìƒ)

**ê°œì„ ë°©í–¥**:
```typescript
// 1. ë°ì´í„° ë¡œë”©ì„ ìˆœì°¨ì ìœ¼ë¡œ
useEffect(() => {
  if (!selectedMonth || !selectedEmployeeId) return;
  
  async function loadAllData() {
    setLoading(true);
    try {
      const [emp, contracts, schedules] = await Promise.all([
        loadEmployees(),
        loadContracts(),
        loadSchedules()
      ]);
      // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ê³„ì‚°
      calculatePayroll(emp, contracts, schedules);
    } finally {
      setLoading(false);
    }
  }
  
  loadAllData();
}, [selectedMonth, selectedEmployeeId]);

// 2. ê³„ì‚° ë¡œì§ ë¶„ë¦¬
function calculateBasePay(employee, contract, workHours) { ... }
function calculateProbation(employee, contract, schedules) { ... }
function calculateWeeklyHoliday(employee, contract, schedules) { ... }
function calculateDeductions(employee, contract, grossPay) { ... }
```

---

## ğŸ”„ ë°ì´í„° íë¦„

### ê·¼ë¬´ì‹œê°„ â†’ ê¸‰ì—¬ê³„ì‚° íë¦„
```
1. schedules ì»¬ë ‰ì…˜
   â”œâ”€> ì˜ˆì •ê·¼ë¬´ì‹œê°„ (scheduledHours, breakTime)
   â””â”€> WorkTimeComparisonì—ì„œ ë¡œë“œ

2. WorkTimeComparison
   â”œâ”€> ì‹¤ì œê·¼ë¬´ì‹œê°„ ì…ë ¥ (actualHours, actualWorkHours)
   â””â”€> workTimeComparisonResultsì— ì €ì¥
       â””â”€> status: time_match / review_required / review_completed

3. employeeReviewStatus
   â””â”€> ì§€ì ë³„ ê²€í† ì™„ë£Œ ì—¬ë¶€ (ê²€í† ì „/ê²€í† ì¤‘/ê²€í† ì™„ë£Œ)

4. PayrollCalculation
   â”œâ”€> workTimeComparisonResultsì—ì„œ actualWorkHours ì¡°íšŒ
   â”œâ”€> employmentContractsì—ì„œ ê³„ì•½ì •ë³´ ì¡°íšŒ
   â”œâ”€> ê¸‰ì—¬ ê³„ì‚° (ê¸°ë³¸ê¸‰, ìˆ˜ìŠµ, ì£¼íœ´ìˆ˜ë‹¹, ê³µì œ)
   â””â”€> í™•ì • ì‹œ confirmedPayrollsì— ì €ì¥

5. TaxFileGeneration
   â””â”€> confirmedPayrollsì—ì„œ í™•ì •ëœ ê¸‰ì—¬ ì¡°íšŒ
       â””â”€> ì—‘ì…€ íŒŒì¼ ìƒì„±
```

---

## ğŸ“Š ì£¼ìš” ê³„ì‚° ë¡œì§

### 1. ìˆ˜ìŠµê¸°ê°„ ê³„ì‚°
```typescript
// ìˆ˜ìŠµê¸°ê°„ íŒë‹¨
const isProbation = (date: Date) => {
  if (!probationStartDate || !probationEndDate) return false;
  const dateOnly = new Date(date.toISOString().split('T')[0]);
  const startOnly = new Date(probationStartDate.toISOString().split('T')[0]);
  const endOnly = new Date(probationEndDate.toISOString().split('T')[0]);
  return dateOnly >= startOnly && dateOnly <= endOnly;
}

// ìˆ˜ìŠµê¸°ê°„ ì‹œê¸‰ ì ìš©
ìˆ˜ìŠµê¸°ê°„_ê¸‰ì—¬ = ìˆ˜ìŠµê¸°ê°„_ê·¼ë¬´ì‹œê°„ * ì‹œê¸‰ * 0.9
ì •ê·œ_ê¸‰ì—¬ = ì •ê·œ_ê·¼ë¬´ì‹œê°„ * ì‹œê¸‰
```

**ì£¼ì˜ì‚¬í•­**:
- ë‚ ì§œ ë¹„êµ ì‹œ ì‹œê°„ ì œê±° (YYYY-MM-DDë§Œ ë¹„êµ)
- Firestore Timestamp â†’ Date ë³€í™˜ í•„ìˆ˜

---

### 2. ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚°
```typescript
// ì¡°ê±´
1. ì‹œê¸‰ì œì—¬ì•¼ í•¨
2. includesWeeklyHolidayInWageê°€ falseì—¬ì•¼ í•¨
3. ê³ ìš©í˜•íƒœê°€ 'ê·¼ë¡œì†Œë“', 'ì‚¬ì—…ì†Œë“', 'ì™¸êµ­ì¸'ì´ì–´ì•¼ í•¨
4. í•´ë‹¹ ì£¼ì— ìŠ¤ì¼€ì¤„ëœ ëª¨ë“  ë‚  ì¶œê·¼í•´ì•¼ í•¨

// ê³„ì‚°
ì£¼íœ´ìˆ˜ë‹¹_ì‹œê°„ = (ì£¼ê°„ê³„ì•½ì‹œê°„ / ì£¼ê°„ê·¼ë¬´ì¼ìˆ˜) * 1ì¼
ì£¼íœ´ìˆ˜ë‹¹_ê¸ˆì•¡ = ì£¼íœ´ìˆ˜ë‹¹_ì‹œê°„ * ì‹œê¸‰
```

**ë¡œì§**:
- `calcWeeklyHolidayPay()` í•¨ìˆ˜ ì‚¬ìš©
- ì£¼ì°¨ë³„ë¡œ ê³„ì‚°í•˜ì—¬ í•©ì‚°
- ì²«ì§¸ì£¼ëŠ” ì „ì£¼ ì¶œê·¼ ì—¬ë¶€ë„ í™•ì¸

---

### 3. 4ëŒ€ë³´í—˜ ê³„ì‚° (ê·¼ë¡œì†Œë“ìë§Œ)
```typescript
// 2025ë…„ ê¸°ì¤€
êµ­ë¯¼ì—°ê¸ˆ = ì§€ê¸‰ì´ì•¡ * 0.045      // 4.5%
ê±´ê°•ë³´í—˜ = ì§€ê¸‰ì´ì•¡ * 0.03545    // 3.545%
ì¥ê¸°ìš”ì–‘ë³´í—˜ = ê±´ê°•ë³´í—˜ * 0.1295 // ê±´ê°•ë³´í—˜ì˜ 12.95%
ê³ ìš©ë³´í—˜ = ì§€ê¸‰ì´ì•¡ * 0.009      // 0.9%

4ëŒ€ë³´í—˜_í•©ê³„ = êµ­ë¯¼ì—°ê¸ˆ + ê±´ê°•ë³´í—˜ + ì¥ê¸°ìš”ì–‘ë³´í—˜ + ê³ ìš©ë³´í—˜
```

---

### 4. ì†Œë“ì„¸ ê³„ì‚° (ê·¼ë¡œì†Œë“ìë§Œ)
```typescript
// ê°„ì´ì„¸ì•¡í‘œ (ë¶€ì–‘ê°€ì¡± 1ëª… ê¸°ì¤€)
if (ì›”ê¸‰ <= 1,060,000) {
  ì†Œë“ì„¸ = 0
} else if (ì›”ê¸‰ <= 2,100,000) {
  ì†Œë“ì„¸ = (ì›”ê¸‰ - 1,060,000) * 0.02
} else if (ì›”ê¸‰ <= 3,160,000) {
  ì†Œë“ì„¸ = 20,800 + (ì›”ê¸‰ - 2,100,000) * 0.04
} else if (ì›”ê¸‰ <= 5,000,000) {
  ì†Œë“ì„¸ = 63,200 + (ì›”ê¸‰ - 3,160,000) * 0.06
} else {
  ì†Œë“ì„¸ = 173,600 + (ì›”ê¸‰ - 5,000,000) * 0.08
}

ì§€ë°©ì†Œë“ì„¸ = ì†Œë“ì„¸ * 0.1
```

---

### 5. ì‚¬ì—…ì†Œë“ì„¸ ê³„ì‚° (ì‚¬ì—…ì†Œë“ì, ì™¸êµ­ì¸)
```typescript
ì„¸ê¸ˆ = (ê¸°ë³¸ê¸‰ + ì£¼íœ´ìˆ˜ë‹¹) * 0.033  // 3.3%
```

---

### 6. ë¬´ê¸‰íœ´ê°€ ì°¨ê° (ê·¼ë¡œì†Œë“ì + ì›”ê¸‰ì œë§Œ)
```typescript
ì¼í• _ê¸‰ì—¬ = ì›”ê¸‰ / 30ì¼
ë¬´ê¸‰íœ´ê°€_ì°¨ê° = ì¼í• _ê¸‰ì—¬ * ë¬´ê¸‰íœ´ê°€_ì¼ìˆ˜
ê¸°ë³¸ê¸‰ = ì›”ê¸‰ - ë¬´ê¸‰íœ´ê°€_ì°¨ê°
```

---

## âš ï¸ ë¬¸ì œì  ë° ê°œì„ ë°©í–¥

### í˜„ì¬ ë¬¸ì œì 

#### 1. ë¬´í•œë£¨í”„ ë¬¸ì œ
**ì›ì¸**:
```typescript
// PayrollCalculation.tsx
const calculatePayroll = useCallback(() => {
  // ... ê³„ì‚° ë¡œì§ ...
  setPayrollCalculations(ê²°ê³¼);  // state ë³€ê²½
}, [employees, weeklySchedules]);  // employees, weeklySchedules ì˜ì¡´

useEffect(() => {
  calculatePayroll();
}, [selectedEmployeeId, employees, weeklySchedules, calculatePayroll]);
// calculatePayrollì´ ë³€ê²½ë˜ë©´ ë‹¤ì‹œ ì‹¤í–‰ â†’ ë¬´í•œë£¨í”„
```

**í•´ê²°ë°©ë²•**:
```typescript
// ë°©ë²• 1: useCallback ì˜ì¡´ì„± ìµœì†Œí™”
const calculatePayroll = useCallback(() => {
  // ...
}, [selectedEmployeeId]);  // ì§ì› IDë§Œ ì˜ì¡´

// ë°©ë²• 2: useEffectì—ì„œ ì§ì ‘ ê³„ì‚°
useEffect(() => {
  if (!employees.length || !selectedEmployeeId) return;
  
  // ê³„ì‚° ë¡œì§ì„ ì—¬ê¸°ì— ì§ì ‘ ì‘ì„± (useCallback ì‚¬ìš© ì•ˆí•¨)
  const result = ...;
  setPayrollCalculations(result);
}, [selectedEmployeeId, employees, weeklySchedules]);
```

---

#### 2. ë°ì´í„° ë¡œë”© ìˆœì„œ ë¶ˆëª…í™•
**ë¬¸ì œ**:
- employees, contracts, weeklySchedulesê°€ ê°ê° ë‹¤ë¥¸ íƒ€ì´ë°ì— ë¡œë“œ
- ì–´ë–¤ ë°ì´í„°ê°€ ë¨¼ì € í•„ìš”í•œì§€ ë¶ˆëª…í™•

**í•´ê²°ë°©ë²•**:
```typescript
// 1. ìˆœì°¨ì  ë¡œë”©
async function loadPayrollData() {
  setLoading(true);
  try {
    // 1ë‹¨ê³„: ê¸°ë³¸ ë°ì´í„°
    const [branches, employees] = await Promise.all([
      loadBranches(),
      loadEmployees()
    ]);
    
    // 2ë‹¨ê³„: ì„ íƒëœ ì§ì›ì˜ ê³„ì•½ ë° ê·¼ë¬´ì‹œê°„
    if (selectedEmployeeId && selectedMonth) {
      const [contracts, schedules] = await Promise.all([
        loadContracts(selectedEmployeeId, selectedMonth),
        loadSchedules(selectedEmployeeId, selectedMonth)
      ]);
      
      // 3ë‹¨ê³„: ê³„ì‚°
      const result = calculatePayroll(employees, contracts, schedules);
      setPayrollCalculations([result]);
    }
  } finally {
    setLoading(false);
  }
}
```

---

#### 3. ê³„ì‚° ë¡œì§ì´ í•œ í•¨ìˆ˜ì— ì§‘ì¤‘
**ë¬¸ì œ**:
- `calculatePayroll()` í•¨ìˆ˜ê°€ 500ì¤„ ì´ìƒ
- ìˆ˜ìŠµ, ì£¼íœ´ìˆ˜ë‹¹, 4ëŒ€ë³´í—˜, ì„¸ê¸ˆ ê³„ì‚°ì´ ëª¨ë‘ ì„ì—¬ìˆìŒ

**í•´ê²°ë°©ë²•**:
```typescript
// ê³„ì‚° ë¡œì§ ë¶„ë¦¬
class PayrollCalculator {
  constructor(employee, contract, schedules) {
    this.employee = employee;
    this.contract = contract;
    this.schedules = schedules;
  }
  
  // 1. ê·¼ë¬´ì‹œê°„ ê³„ì‚°
  calculateWorkHours() {
    const total = this.schedules.reduce((sum, s) => sum + s.actualWorkHours, 0);
    return total;
  }
  
  // 2. ìˆ˜ìŠµê¸°ê°„ êµ¬ë¶„
  separateProbationHours() {
    const probationHours = 0;
    const regularHours = 0;
    // ...
    return { probationHours, regularHours };
  }
  
  // 3. ê¸°ë³¸ê¸‰ ê³„ì‚°
  calculateBasePay({ probationHours, regularHours }) {
    if (this.contract.salaryType === 'hourly') {
      return probationHours * this.contract.salaryAmount * 0.9
           + regularHours * this.contract.salaryAmount;
    } else {
      return this.contract.salaryAmount;  // ì›”ê¸‰
    }
  }
  
  // 4. ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚°
  calculateWeeklyHoliday() {
    // ...
  }
  
  // 5. ê³µì œ ê³„ì‚°
  calculateDeductions(grossPay) {
    if (this.contract.employmentType === 'ê·¼ë¡œì†Œë“') {
      return this.calculateInsuranceAndTax(grossPay);
    } else {
      return this.calculateBusinessTax(grossPay);
    }
  }
  
  // ìµœì¢… ê³„ì‚°
  calculate() {
    const workHours = this.calculateWorkHours();
    const { probationHours, regularHours } = this.separateProbationHours();
    const basePay = this.calculateBasePay({ probationHours, regularHours });
    const weeklyHoliday = this.calculateWeeklyHoliday();
    const grossPay = basePay + weeklyHoliday;
    const deductions = this.calculateDeductions(grossPay);
    const netPay = grossPay - deductions.total;
    
    return {
      basePay,
      weeklyHoliday,
      grossPay,
      deductions,
      netPay,
      // ...
    };
  }
}
```

---

#### 4. íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ íƒ€ì… ë¶ˆì¼ì¹˜
**ë¬¸ì œ**:
- `schedule.date`ê°€ ë•Œë¡œëŠ” `string`, ë•Œë¡œëŠ” `Date`, ë•Œë¡œëŠ” `Timestamp`
- íƒ€ì… ë‹¨ì–¸ (`as Date`) ë‚¨ë°œ

**í•´ê²°ë°©ë²•**:
```typescript
// 1. ëª…í™•í•œ íƒ€ì… ì •ì˜
interface Schedule {
  id: string;
  employeeId: string;
  date: Date;  // í•­ìƒ Date íƒ€ì…
  // ...
}

// 2. Firestoreì—ì„œ ë¡œë“œí•  ë•Œ ë³€í™˜
const schedules = schedulesSnapshot.docs.map(doc => {
  const data = doc.data();
  return {
    id: doc.id,
    ...data,
    date: data.date?.toDate ? data.date.toDate() : new Date(data.date),
    // ëª¨ë“  Date í•„ë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë³€í™˜
  };
});
```

---

### ê¶Œì¥ ê°œì„  ë°©í–¥

#### 1. ì»´í¬ë„ŒíŠ¸ ì¬êµ¬ì„±
```
EmployeePayrollProcessing (ìµœìƒìœ„)
â”œâ”€ EmployeeList (ì§ì› ëª©ë¡)
â”‚  â””â”€ ì§ì› ì„ íƒ â†’ selectedEmployeeId ì—…ë°ì´íŠ¸
â”œâ”€ PayrollTabs (íƒ­ ì „í™˜)
â”‚  â”œâ”€ WorkTimeComparisonTab
â”‚  â”‚  â””â”€ WorkTimeComparison ì»´í¬ë„ŒíŠ¸
â”‚  â””â”€ PayrollCalculationTab
â”‚     â”œâ”€ PayrollDataLoader (ë°ì´í„° ë¡œë”© ì „ìš©)
â”‚     â”œâ”€ PayrollCalculator (ê³„ì‚° ë¡œì§ ì „ìš©)
â”‚     â””â”€ PayrollDisplay (ê²°ê³¼ í‘œì‹œ ì „ìš©)
```

#### 2. ë°ì´í„° ë¡œë”© ì „ìš© í›… ì‘ì„±
```typescript
// hooks/usePayrollData.ts
export function usePayrollData(employeeId: string, month: string) {
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState(null);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    if (!employeeId || !month) return;
    
    let cancelled = false;
    
    async function load() {
      setLoading(true);
      try {
        const employee = await loadEmployee(employeeId);
        const contract = await loadContract(employeeId, month);
        const schedules = await loadSchedules(employeeId, month);
        
        if (!cancelled) {
          setData({ employee, contract, schedules });
        }
      } catch (err) {
        if (!cancelled) {
          setError(err);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    }
    
    load();
    
    return () => { cancelled = true; };
  }, [employeeId, month]);
  
  return { data, loading, error };
}
```

#### 3. ê³„ì‚° ë¡œì§ì„ ë³„ë„ ìœ í‹¸ë¦¬í‹°ë¡œ ë¶„ë¦¬
```typescript
// utils/payrollCalculator.ts
export class PayrollCalculator {
  // ... (ìœ„ì—ì„œ ì„¤ëª…í•œ í´ë˜ìŠ¤)
}

// ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
import { PayrollCalculator } from '@/utils/payrollCalculator';

const calculator = new PayrollCalculator(employee, contract, schedules);
const result = calculator.calculate();
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸‰ì—¬ ê³„ì‚° ì „ í•„ìˆ˜ í™•ì¸ì‚¬í•­
- [ ] ì§ì›ì˜ ì…ì‚¬ì¼/í‡´ì‚¬ì¼ì´ ì˜¬ë°”ë¥¸ê°€?
- [ ] í•´ë‹¹ì›”ì— ìœ íš¨í•œ ê·¼ë¡œê³„ì•½ì´ ì¡´ì¬í•˜ëŠ”ê°€?
- [ ] ê·¼ë¡œê³„ì•½ì˜ ê³ ìš©í˜•íƒœ, ê¸‰ì—¬í˜•íƒœ, ê¸‰ì—¬ì•¡ì´ ì˜¬ë°”ë¥¸ê°€?
- [ ] ìˆ˜ìŠµê¸°ê°„ ì •ë³´ê°€ ì •í™•í•œê°€?
- [ ] ì£¼íœ´ìˆ˜ë‹¹ í¬í•¨ ì—¬ë¶€ê°€ ì˜¬ë°”ë¥¸ê°€?
- [ ] ëª¨ë“  ì§€ì ì˜ ê·¼ë¬´ì‹œê°„ë¹„êµê°€ 'ê²€í† ì™„ë£Œ'ì¸ê°€?
- [ ] workTimeComparisonResultsì— ì‹¤ê·¼ë¬´ì‹œê°„ ë°ì´í„°ê°€ ìˆëŠ”ê°€?

### ê¸‰ì—¬ í™•ì • ì „ í•„ìˆ˜ í™•ì¸ì‚¬í•­
- [ ] ê³„ì‚°ëœ ê¸‰ì—¬ê°€ ì˜¬ë°”ë¥¸ê°€?
- [ ] ìˆ˜ìŠµê¸°ê°„ ì ìš©ì´ ì˜¬ë°”ë¥¸ê°€?
- [ ] ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚°ì´ ì˜¬ë°”ë¥¸ê°€?
- [ ] 4ëŒ€ë³´í—˜/ì„¸ê¸ˆ ê³„ì‚°ì´ ì˜¬ë°”ë¥¸ê°€?
- [ ] ì€í–‰ì •ë³´ê°€ ì…ë ¥ë˜ì–´ ìˆëŠ”ê°€?
- [ ] ì£¼ë¯¼ë²ˆí˜¸ê°€ ì…ë ¥ë˜ì–´ ìˆëŠ”ê°€?

---

## ğŸ¯ ê²°ë¡ 

### í•µì‹¬ ë¬¸ì œ ìš”ì•½
1. **ë¬´í•œë£¨í”„**: useEffect/useCallback ì˜ì¡´ì„± ë°°ì—´ ë¬¸ì œ
2. **ë°ì´í„° ë¡œë”© ìˆœì„œ**: ì–´ë–¤ ë°ì´í„°ê°€ ë¨¼ì € í•„ìš”í•œì§€ ë¶ˆëª…í™•
3. **ë³µì¡í•œ ê³„ì‚° ë¡œì§**: í•œ í•¨ìˆ˜ì— ëª¨ë“  ë¡œì§ ì§‘ì¤‘
4. **íƒ€ì… ë¶ˆì¼ì¹˜**: Date/string/Timestamp í˜¼ìš©

### í•´ê²° ë°©í–¥
1. **ëª…í™•í•œ ë°ì´í„° íë¦„**: ìˆœì°¨ì  ë¡œë”© (employees â†’ contracts â†’ schedules â†’ calculate)
2. **ê³„ì‚° ë¡œì§ ë¶„ë¦¬**: í´ë˜ìŠ¤ ë˜ëŠ” ì—¬ëŸ¬ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
3. **íƒ€ì… ì•ˆì •ì„±**: Firestoreì—ì„œ ë¡œë“œí•  ë•Œ ì¦‰ì‹œ Dateë¡œ ë³€í™˜
4. **ë‹¨ìˆœí•œ ì˜ì¡´ì„±**: useCallback ìµœì†Œí™”, useEffect ëª…í™•í™”

ì´ ë¬¸ì„œë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸‰ì—¬ì²˜ë¦¬ ì‹œìŠ¤í…œì„ ê°œì„ í•˜ì‹œë©´ ë” ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•  ê²ƒì…ë‹ˆë‹¤!

